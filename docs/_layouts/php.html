<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
</head>
<body>
	<h1>Processing Comment...</h1>

	<?php

		// code modified from https://github.com/mpalmer/jekyll-static-comments

		$DATE_FORMAT = "Y-m-d H:i";

		$EMAIL_ADDRESS = "andreablog72@gmail.com";

		$SUBJECT = "Blog comment received";

		$msg = "date: " . date($DATE_FORMAT) . "\n";

		// keys: post_id, comreturnurl, name, comment

		$key = "post_id";
		$value = $_GET[$key];

		if (strstr($value, "\n") != "") {
			$value = str_replace("\n", "\n  ", $value);
		}
		$value = "'" . str_replace("'", "''", $value) . "'";
		$msg .= "$key: $value\n";

		$key = "comreturnurl";
		$value = $_GET[$key];

		if (strstr($value, "\n") != "") {
			$value = str_replace("\n", "\n  ", $value);
		}
		$value = "'" . str_replace("'", "''", $value) . "'";
		$msg .= "$key: $value\n";

		$key = "name";
		$value = $_GET[$key];

		if (strstr($value, "\n") != "") {
			$value = str_replace("\n", "\n  ", $value);
		}
		$value = "'" . str_replace("'", "''", $value) . "'";
		$msg .= "$key: $value\n";

		$key = "comment";
		$value = $_GET[$key];

		if (strstr($value, "\n") != "") {
			$value = str_replace("\n", "\n  ", $value);
		}
		$value = "'" . str_replace("'", "''", $value) . "'";
		$msg .= "$key: $value\n";

		if (mail($EMAIL_ADDRESS, $SUBJECT, $msg))
		{
			echo '<h1>Comment Received!</h1>';
			echo '<p>Thank you for your comment. It will be reviewed and published shortly.</p>';
			$return_url = $_GET['comreturnurl'];
			$return_delay = 5; //Number of seconds 
			echo "<meta http-equiv=\"refresh\" content=\"$return_delay;url='$return_url'\" />";
			echo '<p>You will be redirected to the original post in 5 seconds. Click the link below if you are not redirected automatically.</p>';
			echo '<p><a href="'.$return_url.'">'.$return_url.'</a></p>';
		}
		else
		{
			echo '<h1>Error!</h1>';
			echo '<p>There was a problem sending the comment. Please contact the site's owner.</p>';
		}

	?>
</body>
</html>
